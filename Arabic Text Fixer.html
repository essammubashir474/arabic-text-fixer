<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Arabic Text Converter (Replica)</title>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;600;700&family=Space+Grotesk:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <style>
    :root {
      --bg: #0f0f14;
      --bg-2: #171822;
      --panel: #1b1d29;
      --panel-2: #222435;
      --text: #f6f2ea;
      --muted: #b7b1a8;
      --accent: #ffb347;
      --accent-2: #ff6b6b;
      --accent-3: #70e1a1;
      --ring: rgba(255, 179, 71, 0.3);
      --border: rgba(255, 255, 255, 0.08);
      --shadow: 0 24px 60px rgba(0, 0, 0, 0.45);
      --shadow-soft: 0 12px 30px rgba(0, 0, 0, 0.35);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      min-height: 100vh;
      font-family: "Space Grotesk", "Noto Kufi Arabic", sans-serif;
      color: var(--text);
      background:
        radial-gradient(900px circle at 12% -10%, rgba(255, 179, 71, 0.2), transparent 55%),
        radial-gradient(700px circle at 100% 0%, rgba(255, 107, 107, 0.2), transparent 50%),
        linear-gradient(180deg, var(--bg), var(--bg-2));
      display: flex;
      justify-content: center;
    }

    .page {
      width: min(1100px, 100%);
      padding: 28px 22px 60px;
      display: flex;
      flex-direction: column;
      gap: 22px;
    }

    header {
      display: flex;
      flex-wrap: wrap;
      align-items: center;
      justify-content: space-between;
      gap: 14px;
    }

    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      font-weight: 700;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      font-size: 0.9rem;
      color: var(--muted);
    }

    .brand .dot {
      width: 12px;
      height: 12px;
      border-radius: 50%;
      background: conic-gradient(from 180deg, var(--accent), var(--accent-2), var(--accent-3));
      box-shadow: 0 0 20px rgba(255, 179, 71, 0.6);
    }

    .hero {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 22px;
      padding: 22px;
      box-shadow: var(--shadow);
      display: grid;
      gap: 10px;
    }

    .hero h1 {
      margin: 0;
      font-size: clamp(1.8rem, 2vw + 1.2rem, 2.8rem);
      line-height: 1.1;
    }

    .hero p {
      margin: 0;
      color: var(--muted);
      font-size: 1rem;
      max-width: 720px;
    }

    .workspace {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
      gap: 18px;
    }

    .panel {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 20px;
      padding: 18px;
      box-shadow: var(--shadow-soft);
      display: flex;
      flex-direction: column;
      gap: 12px;
      min-height: 300px;
    }

    .panel-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .panel-title {
      font-weight: 600;
      font-size: 1.05rem;
    }

    textarea {
      width: 100%;
      min-height: 190px;
      border-radius: 14px;
      border: 1px solid transparent;
      padding: 14px 16px;
      background: var(--panel-2);
      color: var(--text);
      font-family: "Noto Kufi Arabic", "Space Grotesk", sans-serif;
      font-size: 1rem;
      line-height: 1.6;
      resize: vertical;
      box-shadow: inset 0 0 0 1px var(--border);
    }

    textarea:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 4px var(--ring);
    }

    textarea.output {
      background: linear-gradient(130deg, rgba(112, 225, 161, 0.1), rgba(255, 179, 71, 0.08));
    }

    .toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }

    button {
      border: none;
      border-radius: 12px;
      padding: 10px 16px;
      font-size: 0.95rem;
      font-weight: 600;
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
    }

    button.primary {
      background: linear-gradient(120deg, var(--accent), var(--accent-2));
      color: #14131a;
      box-shadow: 0 10px 24px rgba(255, 179, 71, 0.25);
    }

    button.secondary {
      background: rgba(112, 225, 161, 0.16);
      color: var(--accent-3);
    }

    button.ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    button.danger {
      background: rgba(255, 107, 107, 0.2);
      color: var(--accent-2);
    }

    .options {
      display: grid;
      gap: 12px;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    }

    .option-card {
      background: var(--panel);
      border: 1px solid var(--border);
      border-radius: 18px;
      padding: 16px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      box-shadow: var(--shadow-soft);
    }

    .option-card h4 {
      margin: 0 0 4px;
      font-size: 0.95rem;
    }

    .option-card p {
      margin: 0;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .switch {
      position: relative;
      width: 54px;
      height: 28px;
      display: inline-flex;
      align-items: center;
    }

    .switch input {
      opacity: 0;
      width: 0;
      height: 0;
    }

    .slider {
      position: absolute;
      inset: 0;
      background: rgba(255, 255, 255, 0.1);
      border-radius: 999px;
      border: 1px solid var(--border);
      transition: background 0.2s ease, border-color 0.2s ease;
    }

    .slider::after {
      content: "";
      position: absolute;
      width: 22px;
      height: 22px;
      border-radius: 50%;
      background: #f6f2ea;
      top: 2px;
      left: 2px;
      transition: transform 0.2s ease;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.35);
    }

    .switch input:checked + .slider {
      background: linear-gradient(120deg, var(--accent), var(--accent-2));
      border-color: transparent;
    }

    .switch input:checked + .slider::after {
      transform: translateX(26px);
    }

    .stats {
      display: flex;
      justify-content: space-between;
      gap: 12px;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .toast {
      position: fixed;
      right: 22px;
      bottom: 22px;
      background: var(--panel-2);
      border: 1px solid var(--border);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 12px;
      box-shadow: var(--shadow-soft);
      opacity: 0;
      transform: translateY(10px);
      transition: opacity 0.2s ease, transform 0.2s ease;
      pointer-events: none;
    }

    .toast.show {
      opacity: 1;
      transform: translateY(0);
    }

    footer {
      text-align: center;
      color: var(--muted);
      font-size: 0.85rem;
    }

    @media (max-width: 900px) {
      .panel-header {
        flex-direction: column;
        align-items: flex-start;
      }

      .toolbar {
        width: 100%;
      }

      button {
        width: 100%;
      }
    }

    @media (prefers-reduced-motion: reduce) {
      *, *::before, *::after {
        animation: none !important;
        transition: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="page">
    <header>
      <div class="brand">
        <span class="dot"></span>
        Arabic Text Converter
      </div>
    </header>

    <section class="hero">
      <h1>Shape and reverse Arabic text for LTR editors.</h1>
      <p>Paste your Arabic text, convert it into a left-to-right friendly format, and copy the result into CapCut, Premiere, After Effects, or any editor that struggles with Arabic shaping.</p>
    </section>

    <section class="workspace">
      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">Input</div>
          <div class="toolbar">
            <button class="ghost" id="swapBtn" type="button">Swap</button>
            <button class="ghost" id="downloadBtn" type="button">Download TXT</button>
            <button class="danger" id="clearBtn" type="button">Clear All</button>
          </div>
        </div>
        <textarea id="inputText" dir="auto" spellcheck="false" placeholder="Paste Arabic + English text here..."></textarea>
        <div class="stats">
          <span id="inputStats">0 chars - 0 words - 0 lines</span>
          <span id="statusText">Ready.</span>
        </div>
      </div>

      <div class="panel">
        <div class="panel-header">
          <div class="panel-title">Output</div>
          <div class="toolbar">
            <button class="primary" id="fixBtn" type="button">Convert</button>
            <button class="secondary" id="copyBtn" type="button">Copy</button>
          </div>
        </div>
        <textarea id="outputText" class="output" dir="ltr" readonly placeholder="Converted text will appear here..."></textarea>
        <div class="stats">
          <span id="outputStats">0 chars - 0 words - 0 lines</span>
          <span>LTR-safe output</span>
        </div>
      </div>
    </section>

    <section class="options">
      <div class="option-card">
        <div>
          <h4>Auto Convert</h4>
          <p>Update the output every time the input changes.</p>
        </div>
        <label class="switch">
          <input type="checkbox" id="autoFix" checked />
          <span class="slider"></span>
        </label>
      </div>
      <div class="option-card">
        <div>
          <h4>Preserve English + Numbers</h4>
          <p>Keep Latin words readable instead of fully reversing them.</p>
        </div>
        <label class="switch">
          <input type="checkbox" id="preserveLatin" />
          <span class="slider"></span>
        </label>
      </div>
    </section>

    <footer>
      Offline, single-file converter. No data leaves your browser.
      <div>Made by Essam</div>
      <div>For Bugs &amp; Features please contact essammubashir4744@gmail.com</div>
    </footer>
  </div>

  <div class="toast" id="toast">Copied.</div>

  <script>
    const inputText = document.getElementById("inputText");
    const outputText = document.getElementById("outputText");
    const fixBtn = document.getElementById("fixBtn");
    const copyBtn = document.getElementById("copyBtn");
    const clearBtn = document.getElementById("clearBtn");
    const swapBtn = document.getElementById("swapBtn");
    const downloadBtn = document.getElementById("downloadBtn");
    const autoFix = document.getElementById("autoFix");
    const preserveLatin = document.getElementById("preserveLatin");
    const inputStats = document.getElementById("inputStats");
    const outputStats = document.getElementById("outputStats");
    const statusText = document.getElementById("statusText");
    const toast = document.getElementById("toast");

    const ARABIC_FORMS = {
      "\u0621": { isolated: "\uFE80", final: null, initial: null, medial: null },
      "\u0622": { isolated: "\uFE81", final: "\uFE82", initial: null, medial: null },
      "\u0623": { isolated: "\uFE83", final: "\uFE84", initial: null, medial: null },
      "\u0624": { isolated: "\uFE85", final: "\uFE86", initial: null, medial: null },
      "\u0625": { isolated: "\uFE87", final: "\uFE88", initial: null, medial: null },
      "\u0626": { isolated: "\uFE89", final: "\uFE8A", initial: "\uFE8B", medial: "\uFE8C" },
      "\u0627": { isolated: "\uFE8D", final: "\uFE8E", initial: null, medial: null },
      "\u0628": { isolated: "\uFE8F", final: "\uFE90", initial: "\uFE91", medial: "\uFE92" },
      "\u0629": { isolated: "\uFE93", final: "\uFE94", initial: null, medial: null },
      "\u062A": { isolated: "\uFE95", final: "\uFE96", initial: "\uFE97", medial: "\uFE98" },
      "\u062B": { isolated: "\uFE99", final: "\uFE9A", initial: "\uFE9B", medial: "\uFE9C" },
      "\u062C": { isolated: "\uFE9D", final: "\uFE9E", initial: "\uFE9F", medial: "\uFEA0" },
      "\u062D": { isolated: "\uFEA1", final: "\uFEA2", initial: "\uFEA3", medial: "\uFEA4" },
      "\u062E": { isolated: "\uFEA5", final: "\uFEA6", initial: "\uFEA7", medial: "\uFEA8" },
      "\u062F": { isolated: "\uFEA9", final: "\uFEAA", initial: null, medial: null },
      "\u0630": { isolated: "\uFEAB", final: "\uFEAC", initial: null, medial: null },
      "\u0631": { isolated: "\uFEAD", final: "\uFEAE", initial: null, medial: null },
      "\u0632": { isolated: "\uFEAF", final: "\uFEB0", initial: null, medial: null },
      "\u0633": { isolated: "\uFEB1", final: "\uFEB2", initial: "\uFEB3", medial: "\uFEB4" },
      "\u0634": { isolated: "\uFEB5", final: "\uFEB6", initial: "\uFEB7", medial: "\uFEB8" },
      "\u0635": { isolated: "\uFEB9", final: "\uFEBA", initial: "\uFEBB", medial: "\uFEBC" },
      "\u0636": { isolated: "\uFEBD", final: "\uFEBE", initial: "\uFEBF", medial: "\uFEC0" },
      "\u0637": { isolated: "\uFEC1", final: "\uFEC2", initial: "\uFEC3", medial: "\uFEC4" },
      "\u0638": { isolated: "\uFEC5", final: "\uFEC6", initial: "\uFEC7", medial: "\uFEC8" },
      "\u0639": { isolated: "\uFEC9", final: "\uFECA", initial: "\uFECB", medial: "\uFECC" },
      "\u063A": { isolated: "\uFECD", final: "\uFECE", initial: "\uFECF", medial: "\uFED0" },
      "\u0641": { isolated: "\uFED1", final: "\uFED2", initial: "\uFED3", medial: "\uFED4" },
      "\u0642": { isolated: "\uFED5", final: "\uFED6", initial: "\uFED7", medial: "\uFED8" },
      "\u0643": { isolated: "\uFED9", final: "\uFEDA", initial: "\uFEDB", medial: "\uFEDC" },
      "\u0644": { isolated: "\uFEDD", final: "\uFEDE", initial: "\uFEDF", medial: "\uFEE0" },
      "\u0645": { isolated: "\uFEE1", final: "\uFEE2", initial: "\uFEE3", medial: "\uFEE4" },
      "\u0646": { isolated: "\uFEE5", final: "\uFEE6", initial: "\uFEE7", medial: "\uFEE8" },
      "\u0647": { isolated: "\uFEE9", final: "\uFEEA", initial: "\uFEEB", medial: "\uFEEC" },
      "\u0648": { isolated: "\uFEED", final: "\uFEEE", initial: null, medial: null },
      "\u0649": { isolated: "\uFEEF", final: "\uFEF0", initial: null, medial: null },
      "\u064A": { isolated: "\uFEF1", final: "\uFEF2", initial: "\uFEF3", medial: "\uFEF4" }
    };

    const LAM = "\u0644";
    const LAM_ALEF_LIGATURES = {
      "\u0622": { isolated: "\uFEF5", final: "\uFEF6" },
      "\u0623": { isolated: "\uFEF7", final: "\uFEF8" },
      "\u0625": { isolated: "\uFEF9", final: "\uFEFA" },
      "\u0627": { isolated: "\uFEFB", final: "\uFEFC" }
    };

    const ARABIC_CHAR = /[\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;
    const ARABIC_DIACRITIC = /[\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06ED]/;
    const ARABIC_PRESENTATION = /[\uFB50-\uFDFF\uFE70-\uFEFF]/;

    function showToast(message) {
      toast.textContent = message;
      toast.classList.add("show");
      window.clearTimeout(showToast.timer);
      showToast.timer = window.setTimeout(() => toast.classList.remove("show"), 1800);
    }

    function updateStats(text, target) {
      const chars = text.length;
      const words = text.trim() ? text.trim().split(/\s+/).length : 0;
      const lines = text.replace(/\r\n?|\n/g, "\n").split("\n").length;
      target.textContent = `${chars} chars - ${words} words - ${lines} lines`;
    }

    function containsArabic(text) {
      return ARABIC_CHAR.test(text);
    }

    function isArabicDiacritic(ch) {
      return ARABIC_DIACRITIC.test(ch);
    }

    function canConnectToNext(ch) {
      const forms = ARABIC_FORMS[ch];
      return forms ? !!forms.initial : false;
    }

    function canConnectFromPrev(ch) {
      const forms = ARABIC_FORMS[ch];
      return forms ? !!forms.final : false;
    }

    function findPrevLetterIndex(chars, start) {
      for (let i = start; i >= 0; i -= 1) {
        if (isArabicDiacritic(chars[i])) {
          continue;
        }
        return ARABIC_FORMS[chars[i]] ? i : -1;
      }
      return -1;
    }

    function findNextLetterIndex(chars, start) {
      for (let i = start; i < chars.length; i += 1) {
        if (isArabicDiacritic(chars[i])) {
          continue;
        }
        return ARABIC_FORMS[chars[i]] ? i : -1;
      }
      return -1;
    }

    function selectForm(forms, connectPrev, connectNext, fallback) {
      if (connectPrev && connectNext && forms.medial) {
        return forms.medial;
      }
      if (connectPrev && forms.final) {
        return forms.final;
      }
      if (connectNext && forms.initial) {
        return forms.initial;
      }
      return forms.isolated || fallback;
    }

    function isAlefVariant(ch) {
      return Object.prototype.hasOwnProperty.call(LAM_ALEF_LIGATURES, ch);
    }

    function shapeArabic(text) {
      const chars = Array.from(text);
      const result = [];

      for (let i = 0; i < chars.length; i += 1) {
        const ch = chars[i];

        if (isArabicDiacritic(ch)) {
          result.push(ch);
          continue;
        }

        if (ch === LAM && isAlefVariant(chars[i + 1])) {
          const alef = chars[i + 1];
          const prevIndex = findPrevLetterIndex(chars, i - 1);
          const prevChar = prevIndex >= 0 ? chars[prevIndex] : null;
          const connectPrev = prevChar && canConnectToNext(prevChar) && canConnectFromPrev(LAM);
          const ligature = connectPrev ? LAM_ALEF_LIGATURES[alef].final : LAM_ALEF_LIGATURES[alef].isolated;
          result.push(ligature);
          i += 1;
          continue;
        }

        const forms = ARABIC_FORMS[ch];
        if (!forms) {
          result.push(ch);
          continue;
        }

        const prevIndex = findPrevLetterIndex(chars, i - 1);
        const nextIndex = findNextLetterIndex(chars, i + 1);
        const prevChar = prevIndex >= 0 ? chars[prevIndex] : null;
        const nextChar = nextIndex >= 0 ? chars[nextIndex] : null;

        const connectPrev = prevChar && canConnectToNext(prevChar) && canConnectFromPrev(ch);
        const connectNext = nextChar && canConnectFromPrev(nextChar) && canConnectToNext(ch);

        result.push(selectForm(forms, connectPrev, connectNext, ch));
      }

      return result.join("");
    }

    function reverseClusters(text) {
      const clusters = [];
      for (const ch of Array.from(text)) {
        if (isArabicDiacritic(ch) && clusters.length) {
          clusters[clusters.length - 1] += ch;
        } else {
          clusters.push(ch);
        }
      }
      return clusters.reverse().join("");
    }

    function reverseWithPreserveLatin(text) {
      const reversed = reverseClusters(text);
      return reversed.replace(/[A-Za-z0-9]+/g, (segment) => segment.split("").reverse().join(""));
    }

    function transformLine(line) {
      if (!containsArabic(line)) {
        return line;
      }
      const shaped = ARABIC_PRESENTATION.test(line) ? line : shapeArabic(line);
      return preserveLatin.checked ? reverseWithPreserveLatin(shaped) : reverseClusters(shaped);
    }

    function fixText() {
      const normalized = inputText.value.replace(/\r\n?|\n/g, "\n");
      const lines = normalized.split("\n");
      const transformed = lines.map(transformLine).join("\n");
      outputText.value = transformed;
      updateStats(inputText.value, inputStats);
      updateStats(outputText.value, outputStats);
      statusText.textContent = `Converted at ${new Date().toLocaleTimeString()}`;
    }

    function copyOutput() {
      if (!outputText.value.trim()) {
        showToast("Nothing to copy yet.");
        return;
      }
      if (navigator.clipboard && navigator.clipboard.writeText) {
        navigator.clipboard.writeText(outputText.value).then(() => showToast("Copied to clipboard."));
        return;
      }
      outputText.select();
      document.execCommand("copy");
      showToast("Copied to clipboard.");
    }

    function downloadOutput() {
      if (!outputText.value.trim()) {
        showToast("No output to download.");
        return;
      }
      const blob = new Blob([outputText.value], { type: "text/plain" });
      const link = document.createElement("a");
      link.href = URL.createObjectURL(blob);
      link.download = "arabic-text-output.txt";
      link.click();
      URL.revokeObjectURL(link.href);
      showToast("Downloaded TXT.");
    }

    function swapText() {
      const temp = inputText.value;
      inputText.value = outputText.value;
      outputText.value = temp;
      if (autoFix.checked) {
        fixText();
      } else {
        updateStats(inputText.value, inputStats);
        updateStats(outputText.value, outputStats);
      }
    }

    fixBtn.addEventListener("click", fixText);
    copyBtn.addEventListener("click", copyOutput);
    downloadBtn.addEventListener("click", downloadOutput);
    swapBtn.addEventListener("click", swapText);

    clearBtn.addEventListener("click", () => {
      inputText.value = "";
      outputText.value = "";
      updateStats("", inputStats);
      updateStats("", outputStats);
      statusText.textContent = "Cleared.";
    });

    inputText.addEventListener("input", () => {
      updateStats(inputText.value, inputStats);
      if (autoFix.checked) {
        fixText();
      }
    });

    preserveLatin.addEventListener("change", () => autoFix.checked && fixText());

    updateStats("", inputStats);
    updateStats("", outputStats);
  </script>
</body>
</html>
